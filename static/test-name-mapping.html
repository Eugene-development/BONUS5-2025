<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–¢–µ—Å—Ç –º–∞–ø–ø–∏–Ω–≥–∞ name/firstName</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .test-container {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        button {
            background-color: #4CAF50;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
            margin: 5px;
        }
        button:hover {
            background-color: #45a049;
        }
        .log-container {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 4px;
            border: 1px solid #dee2e6;
            margin-top: 20px;
        }
        .log-entry {
            margin-bottom: 10px;
            padding: 8px;
            border-radius: 4px;
        }
        .log-success {
            background-color: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        .log-error {
            background-color: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        .log-info {
            background-color: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
        }
        .test1 { background-color: #17a2b8; }
        .test2 { background-color: #fd7e14; }
        .clear-btn { background-color: #6c757d; }
    </style>
</head>
<body>
    <h1>–¢–µ—Å—Ç –º–∞–ø–ø–∏–Ω–≥–∞ name/firstName</h1>
    <p>–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ API endpoint `/api/register` —Å —Ä–∞–∑–Ω—ã–º–∏ —Ñ–æ—Ä–º–∞—Ç–∞–º–∏ –¥–∞–Ω–Ω—ã—Ö</p>
    
    <div class="test-container">
        <h2>–¢–µ—Å—Ç–æ–≤—ã–µ —Å–ª—É—á–∞–∏</h2>
        <button class="test1" onclick="testWithFirstName()">–¢–µ—Å—Ç —Å firstName</button>
        <button class="test2" onclick="testWithName()">–¢–µ—Å—Ç —Å name</button>
        <button class="clear-btn" onclick="clearLogs()">–û—á–∏—Å—Ç–∏—Ç—å –ª–æ–≥–∏</button>
    </div>

    <div class="log-container">
        <h3>–†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ç–µ—Å—Ç–æ–≤</h3>
        <div id="logs"></div>
    </div>

    <script>
        // –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
        function addLog(message, type = 'info') {
            const logsContainer = document.getElementById('logs');
            const logEntry = document.createElement('div');
            logEntry.className = `log-entry log-${type}`;
            logEntry.innerHTML = `<strong>${new Date().toLocaleTimeString()}</strong> - ${message}`;
            logsContainer.appendChild(logEntry);
            logsContainer.scrollTop = logsContainer.scrollHeight;
        }

        // –û—á–∏—Å—Ç–∫–∞ –ª–æ–≥–æ–≤
        function clearLogs() {
            document.getElementById('logs').innerHTML = '';
        }

        // –¢–µ—Å—Ç —Å firstName (—Ñ–æ—Ä–º–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏)
        async function testWithFirstName() {
            const timestamp = Date.now();
            const testData = {
                firstName: '–¢–µ—Å—Ç FirstName',
                city: '–ú–æ—Å–∫–≤–∞',
                email: `firstname-test-${timestamp}@example.com`,
                password: 'testpassword123',
                password_confirmation: 'testpassword123',
                terms_accepted: true
            };

            addLog('üß™ –¢–ï–°–¢ 1: –û—Ç–ø—Ä–∞–≤–∫–∞ —Å –ø–æ–ª–µ–º firstName', 'info');
            addLog(`üìù –î–∞–Ω–Ω—ã–µ: ${JSON.stringify(testData, null, 2)}`, 'info');
            
            await sendRegistrationRequest(testData, 'firstName');
        }

        // –¢–µ—Å—Ç —Å name (–ø—Ä—è–º—ã–µ –¥–∞–Ω–Ω—ã–µ)
        async function testWithName() {
            const timestamp = Date.now();
            const testData = {
                name: '–¢–µ—Å—Ç Name',
                city: '–°–∞–Ω–∫—Ç-–ü–µ—Ç–µ—Ä–±—É—Ä–≥',
                email: `name-test-${timestamp}@example.com`,
                password: 'testpassword123',
                password_confirmation: 'testpassword123',
                terms_accepted: true
            };

            addLog('üß™ –¢–ï–°–¢ 2: –û—Ç–ø—Ä–∞–≤–∫–∞ —Å –ø–æ–ª–µ–º name', 'info');
            addLog(`üìù –î–∞–Ω–Ω—ã–µ: ${JSON.stringify(testData, null, 2)}`, 'info');
            
            await sendRegistrationRequest(testData, 'name');
        }

        // –û—Ç–ø—Ä–∞–≤–∫–∞ –∑–∞–ø—Ä–æ—Å–∞ –Ω–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—é
        async function sendRegistrationRequest(data, testType) {
            try {
                const response = await fetch('/api/register', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Accept': 'application/json'
                    },
                    credentials: 'include',
                    body: JSON.stringify(data)
                });

                const result = await response.json();
                
                addLog(`üì° –û—Ç–≤–µ—Ç —Å–µ—Ä–≤–µ—Ä–∞ (${testType}):`, 'info');
                addLog(`Status: ${response.status} ${response.statusText}`, 'info');
                addLog(`üì¶ –î–∞–Ω–Ω—ã–µ: ${JSON.stringify(result, null, 2)}`, 'info');
                
                if (response.ok && result.user) {
                    addLog(`‚úÖ –¢–ï–°–¢ ${testType.toUpperCase()}: –£–°–ü–ï–®–ù–û`, 'success');
                    addLog(`üë§ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å–æ–∑–¥–∞–Ω: ${result.user.name} (${result.user.email})`, 'success');
                } else if (response.status === 422) {
                    addLog(`‚ùå –¢–ï–°–¢ ${testType.toUpperCase()}: –û–®–ò–ë–ö–ê –í–ê–õ–ò–î–ê–¶–ò–ò`, 'error');
                    addLog(`üí• –û—à–∏–±–∫–∏: ${JSON.stringify(result.errors, null, 2)}`, 'error');
                } else {
                    addLog(`‚ùå –¢–ï–°–¢ ${testType.toUpperCase()}: –ù–ï–ò–ó–í–ï–°–¢–ù–ê–Ø –û–®–ò–ë–ö–ê`, 'error');
                    addLog(`üí• –°–æ–æ–±—â–µ–Ω–∏–µ: ${result.message || '–ù–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏—è'}`, 'error');
                }
            } catch (error) {
                addLog(`üí• –¢–ï–°–¢ ${testType.toUpperCase()}: –û–®–ò–ë–ö–ê –°–ï–¢–ò`, 'error');
                addLog(`üîç –î–µ—Ç–∞–ª–∏: ${error.message}`, 'error');
                console.error('Registration test error:', error);
            }
            
            addLog('---', 'info');
        }

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
        window.addEventListener('load', () => {
            addLog('üöÄ –°—Ç—Ä–∞–Ω–∏—Ü–∞ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –∑–∞–≥—Ä—É–∂–µ–Ω–∞', 'info');
            addLog('üìã –î–æ—Å—Ç—É–ø–Ω—ã–µ —Ç–µ—Å—Ç—ã:', 'info');
            addLog('‚Ä¢ –¢–µ—Å—Ç 1: firstName ‚Üí name –º–∞–ø–ø–∏–Ω–≥', 'info');
            addLog('‚Ä¢ –¢–µ—Å—Ç 2: name ‚Üí name –ø—Ä—è–º–∞—è –ø–µ—Ä–µ–¥–∞—á–∞', 'info');
            addLog('---', 'info');
        });
    </script>
</body>
</html> 