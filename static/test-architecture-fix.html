<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–¢–µ—Å—Ç –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã –∫–ª–∏–µ–Ω—Ç-—Å–µ—Ä–≤–µ—Ä–Ω–æ–≥–æ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .test-container {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        button {
            background-color: #4CAF50;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
            margin: 5px;
        }
        button:hover {
            background-color: #45a049;
        }
        .log-container {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 4px;
            border: 1px solid #dee2e6;
            margin-top: 20px;
        }
        .log-entry {
            margin-bottom: 10px;
            padding: 8px;
            border-radius: 4px;
        }
        .log-success {
            background-color: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        .log-error {
            background-color: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        .log-info {
            background-color: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
        }
        .test-login { background-color: #007bff; }
        .test-register { background-color: #17a2b8; }
        .clear-btn { background-color: #6c757d; }
    </style>
</head>
<body>
    <h1>–¢–µ—Å—Ç –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω–æ–π –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã</h1>
    <p>–ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–π –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏–∏: –ë—Ä–∞—É–∑–µ—Ä ‚Üí SvelteKit API ‚Üí Laravel Backend</p>
    
    <div class="test-container">
        <h2>–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–µ —Ç–µ—Å—Ç—ã</h2>
        <button class="test-login" onclick="testLogin()">–¢–µ—Å—Ç –ª–æ–≥–∏–Ω–∞</button>
        <button class="test-register" onclick="testRegister()">–¢–µ—Å—Ç —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏</button>
        <button class="clear-btn" onclick="clearLogs()">–û—á–∏—Å—Ç–∏—Ç—å –ª–æ–≥–∏</button>
    </div>

    <div class="log-container">
        <h3>–†–µ–∑—É–ª—å—Ç–∞—Ç—ã</h3>
        <div id="logs"></div>
    </div>

    <script>
        // –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
        function addLog(message, type = 'info') {
            const logsContainer = document.getElementById('logs');
            const logEntry = document.createElement('div');
            logEntry.className = `log-entry log-${type}`;
            logEntry.innerHTML = `<strong>${new Date().toLocaleTimeString()}</strong> - ${message}`;
            logsContainer.appendChild(logEntry);
            logsContainer.scrollTop = logsContainer.scrollHeight;
        }

        // –û—á–∏—Å—Ç–∫–∞ –ª–æ–≥–æ–≤
        function clearLogs() {
            document.getElementById('logs').innerHTML = '';
        }

        // –¢–µ—Å—Ç –ª–æ–≥–∏–Ω–∞
        async function testLogin() {
            addLog('üîê –¢–ï–°–¢ –õ–û–ì–ò–ù–ê: –ü—Ä–æ–≤–µ—Ä–∫–∞ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã –∫–ª–∏–µ–Ω—Ç ‚Üí SvelteKit API', 'info');
            
            try {
                const response = await fetch('/api/login', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Accept': 'application/json'
                    },
                    credentials: 'include',
                    body: JSON.stringify({
                        email: 'test@example.com',
                        password: 'testpassword',
                        remember: false
                    })
                });

                addLog(`üì° –û—Ç–≤–µ—Ç SvelteKit API: ${response.status} ${response.statusText}`, 'info');
                
                const result = await response.json();
                addLog(`üì¶ –î–∞–Ω–Ω—ã–µ: ${JSON.stringify(result, null, 2)}`, 'info');
                
                if (response.status === 422 || response.status === 401) {
                    addLog('‚úÖ –ê–†–•–ò–¢–ï–ö–¢–£–†–ê –†–ê–ë–û–¢–ê–ï–¢: –ó–∞–ø—Ä–æ—Å –ø—Ä–æ—à–µ–ª —á–µ—Ä–µ–∑ SvelteKit API –∫ Laravel', 'success');
                } else if (response.ok) {
                    addLog('‚úÖ –õ–û–ì–ò–ù –£–°–ü–ï–®–ï–ù: –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ', 'success');
                } else {
                    addLog('‚ö†Ô∏è –ù–µ–æ–∂–∏–¥–∞–Ω–Ω—ã–π –æ—Ç–≤–µ—Ç, –Ω–æ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç', 'info');
                }
            } catch (error) {
                if (error.message.includes('host.docker.internal')) {
                    addLog('‚ùå –û–®–ò–ë–ö–ê –ê–†–•–ò–¢–ï–ö–¢–£–†–´: –í—Å–µ –µ—â–µ –æ–±—Ä–∞—â–∞–µ—Ç—Å—è –∫ host.docker.internal', 'error');
                } else {
                    addLog(`‚ùå –û—à–∏–±–∫–∞ —Å–µ—Ç–∏: ${error.message}`, 'error');
                }
                console.error('Login test error:', error);
            }
            
            addLog('---', 'info');
        }

        // –¢–µ—Å—Ç —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏
        async function testRegister() {
            const timestamp = Date.now();
            addLog('üìù –¢–ï–°–¢ –†–ï–ì–ò–°–¢–†–ê–¶–ò–ò: –ü—Ä–æ–≤–µ—Ä–∫–∞ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã –∫–ª–∏–µ–Ω—Ç ‚Üí SvelteKit API', 'info');
            
            try {
                const response = await fetch('/api/register', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Accept': 'application/json'
                    },
                    credentials: 'include',
                    body: JSON.stringify({
                        firstName: '–¢–µ—Å—Ç –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã',
                        city: '–ú–æ—Å–∫–≤–∞',
                        email: `architecture-test-${timestamp}@example.com`,
                        password: 'testpassword123',
                        password_confirmation: 'testpassword123',
                        terms_accepted: true
                    })
                });

                addLog(`üì° –û—Ç–≤–µ—Ç SvelteKit API: ${response.status} ${response.statusText}`, 'info');
                
                const result = await response.json();
                addLog(`üì¶ –î–∞–Ω–Ω—ã–µ: ${JSON.stringify(result, null, 2)}`, 'info');
                
                if (response.ok && result.user) {
                    addLog('‚úÖ –†–ï–ì–ò–°–¢–†–ê–¶–ò–Ø –£–°–ü–ï–®–ù–ê: –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç –∏–¥–µ–∞–ª—å–Ω–æ', 'success');
                    addLog(`üë§ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å–æ–∑–¥–∞–Ω: ${result.user.name}`, 'success');
                } else if (response.status === 422) {
                    addLog('‚úÖ –ê–†–•–ò–¢–ï–ö–¢–£–†–ê –†–ê–ë–û–¢–ê–ï–¢: –í–∞–ª–∏–¥–∞—Ü–∏—è –ø—Ä–æ—à–ª–∞ —á–µ—Ä–µ–∑ SvelteKit API', 'success');
                } else {
                    addLog('‚ö†Ô∏è –ù–µ–æ–∂–∏–¥–∞–Ω–Ω—ã–π –æ—Ç–≤–µ—Ç, –Ω–æ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç', 'info');
                }
            } catch (error) {
                if (error.message.includes('host.docker.internal')) {
                    addLog('‚ùå –û–®–ò–ë–ö–ê –ê–†–•–ò–¢–ï–ö–¢–£–†–´: –í—Å–µ –µ—â–µ –æ–±—Ä–∞—â–∞–µ—Ç—Å—è –∫ host.docker.internal', 'error');
                } else {
                    addLog(`‚ùå –û—à–∏–±–∫–∞ —Å–µ—Ç–∏: ${error.message}`, 'error');
                }
                console.error('Register test error:', error);
            }
            
            addLog('---', 'info');
        }

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
        window.addEventListener('load', () => {
            addLog('üöÄ –¢–µ—Å—Ç –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã –∑–∞–≥—Ä—É–∂–µ–Ω', 'info');
            addLog('üìã –ü—Ä–æ–≤–µ—Ä—è–µ–º:', 'info');
            addLog('‚Ä¢ –ù–µ—Ç –ø—Ä—è–º—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤ –∫ host.docker.internal', 'info');
            addLog('‚Ä¢ –í—Å–µ –∑–∞–ø—Ä–æ—Å—ã –∏–¥—É—Ç —á–µ—Ä–µ–∑ SvelteKit API (/api/*)', 'info');
            addLog('‚Ä¢ CSRF —Ç–æ–∫–µ–Ω—ã –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç—Å—è –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ', 'info');
            addLog('---', 'info');
        });
    </script>
</body>
</html> 